<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Track your Kondappali Toys order status and delivery.">
    <title>Track Your Order - Kondappali Toys</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/orders.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <span>üöö Free Shipping on orders over $50</span>
                <div class="header-top-right">
                    <a href="orders.html">üì¶ Track Order</a>
                    <span>üìû 1-800-KONDAPALLI</span>
                </div>
            </div>
        </div>
        <nav class="navbar">
            <div class="container">
                <a href="index.html" class="logo">
                    <span class="logo-icon">üé®</span>
                    <span>Kondappali<span class="logo-accent">Toys</span></span>
                </a>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="products.html">Shop</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="orders.html" class="active">Track Order</a></li>
                </ul>
                <div class="nav-actions">
                    <a href="cart.html" class="cart-link">
                        üõí
                        <span class="cart-count">0</span>
                    </a>
                    <button class="menu-toggle" aria-label="Toggle menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <!-- Page Header -->
        <section class="page-header">
            <div class="container">
                <h1>Track Your Order</h1>
                <p>Enter your order ID to check the status of your order</p>
            </div>
        </section>

        <!-- Order Tracking Section -->
        <section class="section">
            <div class="container">
                <!-- Order Search -->
                <div class="order-search-card">
                    <h2>üîç Find Your Order</h2>
                    <form id="orderSearchForm" class="order-search-form">
                        <div class="form-group">
                            <label for="orderId">Order ID</label>
                            <input type="text" id="orderId" placeholder="e.g., KT12345678" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" placeholder="Email used for order" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Track Order</button>
                    </form>
                </div>

                <!-- Order Result -->
                <div id="orderResult" class="order-result" style="display: none;">
                    <!-- Order details will be loaded here -->
                </div>

                <!-- Recent Orders -->
                <div class="recent-orders-section">
                    <h2>üì¶ Your Recent Orders</h2>
                    <div id="recentOrders" class="orders-list">
                        <!-- Orders will be loaded here -->
                    </div>
                    <div id="noOrders" class="no-orders" style="display: none;">
                        <span class="no-orders-icon">üì≠</span>
                        <h3>No orders yet</h3>
                        <p>When you place an order, it will appear here for easy tracking.</p>
                        <a href="products.html" class="btn btn-primary">Start Shopping</a>
                    </div>
                </div>

                <!-- Demo Orders Section -->
                <div class="demo-section">
                    <h3>üéØ Test the Order System</h3>
                    <p>Click below to create a demo order and see how order tracking works:</p>
                    <button onclick="createDemoOrder()" class="btn btn-secondary">Create Demo Order</button>
                </div>
            </div>
        </section>

        <!-- Order Status Guide -->
        <section class="section order-guide">
            <div class="container">
                <h2 class="section-title">Order Status Guide</h2>
                <div class="status-guide-grid">
                    <div class="status-guide-item">
                        <div class="status-icon" style="background: #2563eb;">‚úì</div>
                        <h4>Order Confirmed</h4>
                        <p>We've received your order and payment has been verified.</p>
                    </div>
                    <div class="status-guide-item">
                        <div class="status-icon" style="background: #7c3aed;">‚öôÔ∏è</div>
                        <h4>Processing</h4>
                        <p>Your order is being prepared by our artisans.</p>
                    </div>
                    <div class="status-guide-item">
                        <div class="status-icon" style="background: #0891b2;">üì¶</div>
                        <h4>Shipped</h4>
                        <p>Your package is on its way to you.</p>
                    </div>
                    <div class="status-guide-item">
                        <div class="status-icon" style="background: #ea580c;">üöö</div>
                        <h4>Out for Delivery</h4>
                        <p>Your package will arrive today!</p>
                    </div>
                    <div class="status-guide-item">
                        <div class="status-icon" style="background: #16a34a;">üéâ</div>
                        <h4>Delivered</h4>
                        <p>Your order has been delivered. Enjoy!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <a href="index.html" class="logo">
                        <span class="logo-icon">üé®</span>
                        <span>Kondappali<span class="logo-accent">Toys</span></span>
                    </a>
                    <p>Preserving and promoting the ancient art of handcrafted wooden collectibles.</p>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="products.html">Shop</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="orders.html">Track Order</a></li>
                        <li><a href="#">Shipping Info</a></li>
                        <li><a href="#">Returns</a></li>
                        <li><a href="#">FAQs</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <span>&copy; 2024 Kondappali Toys. All rights reserved.</span>
            </div>
        </div>
    </footer>

    <script src="js/data.js"></script>
    <script src="js/main.js"></script>
    <script src="js/theme.js"></script>
    <script>
        // Load recent orders
        function loadRecentOrders() {
            const orders = OrderManager.getAllOrders();
            const container = document.getElementById('recentOrders');
            const noOrders = document.getElementById('noOrders');

            if (orders.length === 0) {
                container.style.display = 'none';
                noOrders.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            noOrders.style.display = 'none';

            container.innerHTML = orders.map(order => `
                <div class="order-card" onclick="showOrderDetails('${order.id}')">
                    <div class="order-card-header">
                        <span class="order-id">${order.id}</span>
                        <span class="order-status" style="background: ${OrderManager.getStatusColor(order.status)}">
                            ${OrderManager.getStatusLabel(order.status)}
                        </span>
                    </div>
                    <div class="order-card-body">
                        <div class="order-date">üìÖ ${formatDate(order.date)}</div>
                        <div class="order-items">${order.items.length} item(s)</div>
                        <div class="order-total">${formatCurrency(order.total)}</div>
                    </div>
                    <div class="order-card-footer">
                        <span>View Details ‚Üí</span>
                    </div>
                </div>
            `).join('');
        }

        // Show order details
        function showOrderDetails(orderId) {
            const order = OrderManager.getOrder(orderId);
            if (!order) return;

            const resultDiv = document.getElementById('orderResult');
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });

            resultDiv.innerHTML = `
                <div class="order-details-card">
                    <div class="order-details-header">
                        <div>
                            <h2>Order ${order.id}</h2>
                            <p class="order-date">Placed on ${formatDateTime(order.date)}</p>
                        </div>
                        <span class="order-status-large" style="background: ${OrderManager.getStatusColor(order.status)}">
                            ${OrderManager.getStatusLabel(order.status)}
                        </span>
                    </div>

                    <!-- Order Progress -->
                    <div class="order-progress">
                        <div class="progress-track">
                            <div class="progress-fill" style="width: ${getProgressWidth(order.status)}"></div>
                        </div>
                        <div class="progress-steps">
                            <div class="progress-step ${isStepComplete(order.status, 'confirmed') ? 'complete' : ''}">
                                <span class="step-icon">‚úì</span>
                                <span class="step-label">Confirmed</span>
                            </div>
                            <div class="progress-step ${isStepComplete(order.status, 'processing') ? 'complete' : ''}">
                                <span class="step-icon">‚öôÔ∏è</span>
                                <span class="step-label">Processing</span>
                            </div>
                            <div class="progress-step ${isStepComplete(order.status, 'shipped') ? 'complete' : ''}">
                                <span class="step-icon">üì¶</span>
                                <span class="step-label">Shipped</span>
                            </div>
                            <div class="progress-step ${isStepComplete(order.status, 'delivered') ? 'complete' : ''}">
                                <span class="step-icon">üéâ</span>
                                <span class="step-label">Delivered</span>
                            </div>
                        </div>
                    </div>

                    <!-- Order Items -->
                    <div class="order-items-section">
                        <h3>Items Ordered</h3>
                        <div class="order-items-list">
                            ${order.items.map(item => `
                                <div class="order-item">
                                    <img src="${item.image}" alt="${item.name}" class="order-item-img" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22><rect fill=%22%23f0f0f0%22 width=%22100%22 height=%22100%22/><text fill=%22%23999%22 font-size=%2212%22 x=%2250%22 y=%2250%22 text-anchor=%22middle%22>üé®</text></svg>'">
                                    <div class="order-item-details">
                                        <h4>${item.name}</h4>
                                        <p>Qty: ${item.quantity}</p>
                                    </div>
                                    <div class="order-item-price">${formatCurrency(item.price * item.quantity)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Order Summary -->
                    <div class="order-summary-section">
                        <h3>Order Summary</h3>
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span>${formatCurrency(order.subtotal)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping</span>
                            <span>${order.shipping_cost === 0 ? 'FREE' : formatCurrency(order.shipping_cost)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Tax</span>
                            <span>${formatCurrency(order.tax)}</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span>${formatCurrency(order.total)}</span>
                        </div>
                    </div>

                    <!-- Shipping Address -->
                    <div class="shipping-section">
                        <h3>Shipping Address</h3>
                        <p>
                            ${order.shipping.firstName} ${order.shipping.lastName}<br>
                            ${order.shipping.address}<br>
                            ${order.shipping.city}, ${order.shipping.state} ${order.shipping.zip}<br>
                            ${order.shipping.country || 'United States'}
                        </p>
                    </div>

                    <!-- Status History -->
                    <div class="status-history-section">
                        <h3>Order Timeline</h3>
                        <div class="timeline">
                            ${order.statusHistory.map(entry => `
                                <div class="timeline-item">
                                    <div class="timeline-dot" style="background: ${OrderManager.getStatusColor(entry.status)}"></div>
                                    <div class="timeline-content">
                                        <strong>${OrderManager.getStatusLabel(entry.status)}</strong>
                                        <p>${entry.message}</p>
                                        <span class="timeline-date">${formatDateTime(entry.date)}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="order-actions">
                        <button onclick="simulateStatusUpdate('${order.id}')" class="btn btn-secondary">
                            Simulate Status Update
                        </button>
                        <a href="contact.html" class="btn btn-outline">Need Help?</a>
                    </div>
                </div>
            `;
        }

        // Get progress width based on status
        function getProgressWidth(status) {
            const widths = {
                'confirmed': '25%',
                'processing': '50%',
                'shipped': '75%',
                'out_for_delivery': '90%',
                'delivered': '100%'
            };
            return widths[status] || '0%';
        }

        // Check if step is complete
        function isStepComplete(currentStatus, stepStatus) {
            const order = ['confirmed', 'processing', 'shipped', 'out_for_delivery', 'delivered'];
            return order.indexOf(currentStatus) >= order.indexOf(stepStatus);
        }

        // Simulate status update (for demo)
        function simulateStatusUpdate(orderId) {
            const order = OrderManager.getOrder(orderId);
            if (!order) return;

            const statusFlow = ['confirmed', 'processing', 'shipped', 'out_for_delivery', 'delivered'];
            const currentIndex = statusFlow.indexOf(order.status);

            if (currentIndex < statusFlow.length - 1) {
                const nextStatus = statusFlow[currentIndex + 1];
                const messages = {
                    'processing': 'Your order is being prepared by our artisans',
                    'shipped': 'Your package has been shipped via USPS',
                    'out_for_delivery': 'Your package is out for delivery',
                    'delivered': 'Your package has been delivered'
                };
                OrderManager.updateOrderStatus(orderId, nextStatus, messages[nextStatus]);
                showOrderDetails(orderId);
                loadRecentOrders();
                Cart.showNotification(`Order status updated to: ${OrderManager.getStatusLabel(nextStatus)}`, 'success');
            } else {
                Cart.showNotification('Order has already been delivered!', 'info');
            }
        }

        // Create demo order
        function createDemoOrder() {
            const demoItems = [
                { id: 1, name: 'Dancing Doll (Thanjavur Style)', price: 24.99, image: 'images/dancing-doll-thanjavur_400.jpg', quantity: 1 },
                { id: 2, name: 'Royal Elephants Set', price: 42.00, image: 'images/royal-elephants-ambari_400.jpg', quantity: 1 }
            ];

            const demoShipping = {
                firstName: 'John',
                lastName: 'Doe',
                address: '123 Main Street',
                city: 'New York',
                state: 'NY',
                zip: '10001',
                country: 'United States'
            };

            const demoPayment = {
                method: 'credit_card',
                cardNumber: '4242424242424242'
            };

            const order = OrderManager.createOrder(demoItems, demoShipping, demoPayment);
            Cart.showNotification(`Demo order ${order.id} created!`, 'success');
            loadRecentOrders();
            showOrderDetails(order.id);
        }

        // Search form handler
        document.getElementById('orderSearchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const orderId = document.getElementById('orderId').value.trim();
            const order = OrderManager.getOrder(orderId);

            if (order) {
                showOrderDetails(orderId);
            } else {
                Cart.showNotification('Order not found. Please check the order ID.', 'error');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', loadRecentOrders);
    </script>
</body>
</html>
